<div class="w-100 mt-5" [formGroup]="filterForm">
  <!-- Search Bar Section -->
  <div class="row">
    <div class="col-8 col-md-9">
      <mat-form-field appearance="outline" class="w-100">
        <input matInput type="text" placeholder="What are you looking for?" formControlName="searchTerm" />
      </mat-form-field>
    </div>
    <div class="col-4 col-md-3" style="padding-left: 0">
      <button mat-flat-button class="background-primary w-100 h-100 fs-16" i18n>
        <mat-icon class="d-none d-md-block">search</mat-icon>
        Search
      </button>
    </div>
  </div>

  <!-- Filter Section -->
  <div class="mt-lg-3 border background-on-primary rounded filter-wrapper" [class.open-mobile-filter]="openMobileFilter()">
    <div class="d-flex flex-wrap p-4 justify-content-between align-items-end">
      <div class="d-md-none pt-4 pb-4 w-100 position-relative">
        <h2 style="font-size: 28px" class="fw-bold">Filter</h2>
        <app-icon
          (click)="onCloseFilterMobile()"
          class="d-block position-absolute end-0 top-0 m-3 cursor-pointer"
          iconName="close"
          iconClassName="text-white"
          backgroundColor="#03985C"
        ></app-icon>
      </div>

      <!-- Select Filters - Left Side -->
      <div class="d-flex flex-wrap justify-content-start align-items-lg-end gap-4 w-100 flex-column flex-md-row">
        @for (item of activeFilter; track item.value) {
          @if (item.type == 'select') {
            <div class="{{ item.value }}-wrapper select-wrapper">
              <div class="small-mat-form-field d-flex flex-column align-items-start {{ item.value }}">
                <mat-label class="mb-2 text-wrap filter-item-label">{{ item.name }}</mat-label>
                <mat-form-field appearance="outline" class="w-100 bg-white">
                  <mat-select [formControlName]="item.value" placeholder="{{ item.placeholder ?? 'All' }}">
                    <mat-option [value]="null">All</mat-option>
                    @for (option of item.options; track $index) {
                      <mat-option [value]="getOptionValue(item, option)">
                        {{ option.name }}
                      </mat-option>
                    }
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          }

          @if (item.type == 'checkbox') {
            <div class="d-flex flex-column align-items-start align-self-lg-end {{ item.value }}">
              <mat-label class="mb-2 filter-item-label">{{ item.name }}</mat-label>
              <div class="d-flex gap-2">
                @if (item.options && item.options.length === 1) {
                  <mat-checkbox class="large-checkbox" [formControlName]="item.options[0].value || item.value">
                    <span class="fw-bold">{{ item.options[0].name }}</span>
                  </mat-checkbox>
                } @else {
                  @for (option of item.options; track $index) {
                    <mat-checkbox class="large-checkbox" [formControlName]="option.value">
                      <span class="fw-bold">{{ option.name }}</span>
                    </mat-checkbox>
                  }
                }
              </div>
            </div>
          }
        }

        <!-- @for (item of activeFilter; track item.value) { -->
        <!-- @if (item.type == "checkbox") {
            <div class="d-flex flex-column align-items-start align-self-end">
              <mat-label class="fw-500 mb-2">{{ item.name }}</mat-label>
              <div class="d-flex gap-2">
                @if (item.options && item.options.length === 1) {
                  <mat-checkbox
                    class="large-checkbox"
                    [formControlName]="item.options[0].value || item.value"
                  >
                    <span class="fw-bold">{{ item.options[0].name }}</span>
                  </mat-checkbox>
                } @else {
                  @for (option of item.options; track $index) {
                    <mat-checkbox
                      class="large-checkbox"
                      [formControlName]="option.value"
                    >
                      <span class="fw-bold">{{ option.name }}</span>
                    </mat-checkbox>
                  }
                }
              </div>
            </div>
          } -->
        <!-- } -->
      </div>
    </div>

    <div class="d-flex d-md-none align-items-center gap-4 m-4">
      <div
        class="text-uppercase fw-bold p-3 text-white rounded background-primary d-inline-block cursor-pointer"
        mat-button
        (click)="onUpdateFilter()"
      >
        Update Filter
      </div>

      @if (hasFilterParams) {
        <div class="text-uppercase fw-bold p-3 d-inline-block cursor-pointer" mat-button (click)="clearFilter()">Clear Filter</div>
      }
    </div>
  </div>

  <!-- <div class="d-flex gap-3"> -->
  <div
    class="d-flex align-items-center justify-content-between border rounded px-2 py-3 my-3 d-md-none border-black cursor-pointer"
    (click)="openFilterMobile()"
  >
    <span class="text-uppercase fw-bold">Filter</span>
    <mat-icon>tune</mat-icon>
  </div>
  <!-- </div> -->
</div>
